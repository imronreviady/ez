    tinymce.PluginManager.add('background', function(editor, url) {

        editor.addButton('background', {
            text : 'Background',
            icon : 'image',
            onclick : function() {
                editor.windowManager.open({
                    width: 450,
                    height: 250,
                    resizable: true,
                    title:"Background",
                    body:[
                        {   
                            type: 'textbox',
                            multiline: false, 
                            name: 'image', 
                            label: 'Image'
                        },
                        {   
                            type: 'textbox',
                            multiline: false, 
                            name: 'color', 
                            label: 'Color'
                        }

                    ],
                    onsubmit:function(b){

                        var background = 'background-image:url('+b.data.image+')' + 'background-color:'+b.data.color; 

                        var node   = editor.selection.getNode();
                        var attr   = editor.dom.getAttrib(node, 'background-image');

                        if(typeof attr !== typeof undefined && attr !== false) {
                            editor.dom.setAttrib(node, 'data-background', b.data.image);
                        } else {
                            editor.dom.setAttrib(node, 'style', background);
                        }
                    }
                })                
            }
        });

    });